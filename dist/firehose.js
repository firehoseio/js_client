!function(t){function e(n){if(s[n])return s[n].exports;var i=s[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){var n;n=s(8),"object"==typeof t&&"object"==typeof t.exports?t.exports=n:window.Firehose=n},function(t,e){t.exports=jQuery},function(t,e,s){var n,i,o,r=function(t,e){return function(){return t.apply(e,arguments)}},c=function(t,e){function s(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},u={}.hasOwnProperty;n=s(1),o=s(3),i=function(t){function e(t){this._error=r(this._error,this),this._ping=r(this._ping,this),this._success=r(this._success,this),this.stop=r(this.stop,this),this._requestParams=r(this._requestParams,this),this._request=r(this._request,this),this._protocol=r(this._protocol,this);var s,n,i,o;e.__super__.constructor.call(this,t),null==(s=this.config).ssl&&(s.ssl=!1),(n=this.config).longPoll||(n.longPoll={}),(i=this.config.longPoll).url||(i.url=this._protocol()+":"+this.config.uri),(o=this.config.longPoll).timeout||(o.timeout=25e3),this._lagTime=5e3,this._timeout=this.config.longPoll.timeout+this._lagTime,this._okInterval=this.config.okInterval||0,this._stopRequestLoop=!1,this._lastMessageSequence=0}return c(e,t),e.prototype.messageSequenceHeader="Pragma",e.prototype.name=function(){return"LongPoll"},e.ieSupported=function(){return(document.documentMode||10)>=8},e.supported=function(){var t;return(t=n.ajaxSettings.xhr())?"withCredentials"in t||e.ieSupported():void 0},e.prototype._protocol=function(){return this.config.ssl?"https":"http"},e.prototype._request=function(){var t;if(!this._stopRequestLoop)return t=this._requestParams(),t.last_message_sequence=this._lastMessageSequence,this._lastRequest=n.ajax({url:this.config.longPoll.url,firehose:!0,crossDomain:!0,data:t,timeout:this._timeout,success:this._success,error:this._error,cache:!1})},e.prototype._requestParams=function(){return this.config.params},e.prototype.stop=function(){var t,e,s;if(this._stopRequestLoop=!0,null!=this._lastRequest){try{this._lastRequest.abort()}catch(e){t=e}delete this._lastRequest}if(null!=this._lastPingRequest){try{this._lastPingRequest.abort()}catch(s){t=s}return delete this._lastPingRequest}},e.prototype._success=function(t,e,s){var n,i,o,r,c;if(!this._needToNotifyOfReconnect&&this._succeeded||(this._needToNotifyOfReconnect=!1,this._open(t)),!this._stopRequestLoop){if(200===s.status)try{c=JSON.parse(s.responseText),r=c.message,o=c.last_sequence,this._lastMessageSequence=o||0,this.config.message(this.config.parse(r))}catch(i){n=i}return this.connect(this._okInterval)}},e.prototype._ping=function(){return this._lastPingRequest=n.ajax({url:this.config.uri,method:"HEAD",crossDomain:!0,firehose:!0,data:this._requestParams(),success:function(t){return function(){return t._needToNotifyOfReconnect?(t._needToNotifyOfReconnect=!1,t.config.connected(t)):void 0}}(this)})},e.prototype._error=function(t,e,s){return this._needToNotifyOfReconnect||this._stopRequestLoop||(this._needToNotifyOfReconnect=!0,this.config.disconnected()),this._stopRequestLoop?void 0:(setTimeout(this._ping,this._retryDelay+this._lagTime),setTimeout(this._request,this._retryDelay))},e}(o),t.exports=i},function(t,e){var s,n=function(t,e){return function(){return t.apply(e,arguments)}};s=function(){function t(t){var e;null==t&&(t={}),this.getLastMessageSequence=n(this.getLastMessageSequence,this),this._close=n(this._close,this),this._open=n(this._open,this),this._error=n(this._error,this),this.connect=n(this.connect,this),this.config=t,(e=this.config).params||(e.params={}),this._retryDelay=3e3}return t.supported=function(){return!1},t.prototype.connect=function(t){return null==t&&(t=0),setTimeout(this._request,t),this},t.prototype.name=function(){throw"not implemented in base Transport"},t.prototype.stop=function(){throw"not implemented in base Transport"},t.prototype._request=function(){throw"not implemented in base Transport"},t.prototype._error=function(t){return this._succeeded?(this.config.disconnected(),this.connect(this._retryDelay)):this.config.failed(this)},t.prototype._open=function(t){return this._succeeded=!0,this.config.connected(this)},t.prototype._close=function(t){return this.config.disconnected()},t.prototype.getLastMessageSequence=function(){return this._lastMessageSequence||0},t}(),t.exports=s},function(t,e,s){(function(e){var n,i,o,r,c,u,h,a=function(t,e){return function(){return t.apply(e,arguments)}},p=function(t,e){function s(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},l={}.hasOwnProperty;n=s(1),r=s(3),i=2e3,o=2e4,h=function(t){return t.send(JSON.stringify({ping:"PING"}))},u=function(){return("undefined"!=typeof window&&null!==window?window.WebSocket:void 0)||("undefined"!=typeof e&&null!==e?e.WebSocket:void 0)},c=function(t){function e(t){this._clearKeepalive=a(this._clearKeepalive,this),this._restartKeepAlive=a(this._restartKeepAlive,this),this._cleanUp=a(this._cleanUp,this),this._error=a(this._error,this),this._close=a(this._close,this),this._message=a(this._message,this),this.stop=a(this.stop,this),this.sendStartingMessageSequence=a(this.sendStartingMessageSequence,this),this._lookForInitialPong=a(this._lookForInitialPong,this),this._open=a(this._open,this),this._requestParams=a(this._requestParams,this),this._protocol=a(this._protocol,this),this._request=a(this._request,this),this._sendMessage=a(this._sendMessage,this);var s;e.__super__.constructor.call(this,t),(s=this.config).webSocket||(s.webSocket={}),this.config.webSocket.connectionVerified=this.config.connectionVerified}return p(e,t),e.prototype.name=function(){return"WebSocket"},e.ieSupported=function(){return(document.documentMode||10)>9},e.supported=function(){return!!u()},e.prototype._sendMessage=function(t){var e;return null!=(e=this.socket)?e.send(JSON.stringify(t)):void 0},e.prototype._request=function(){var t,e;try{return this.socket=(new u)(this._protocol()+":"+this.config.uri+"?"+n.param(this._requestParams())),this.socket.onopen=this._open,this.socket.onclose=this._close,this.socket.onerror=this._error,this.socket.onmessage=this._lookForInitialPong}catch(e){return t=e,"undefined"!=typeof console&&null!==console?console.log(t):void 0}},e.prototype._protocol=function(){return this.config.ssl?"wss":"ws"},e.prototype._requestParams=function(){return this.config.params},e.prototype._open=function(){return h(this.socket)},e.prototype._lookForInitialPong=function(t){var e;return this._restartKeepAlive(),isPong(function(){var s;try{return JSON.parse(t.data)}catch(s){return e=s,{}}}())?null!=this._lastMessageSequence?this.sendStartingMessageSequence(this._lastMessageSequence):this.config.webSocket.connectionVerified(this):void 0},e.prototype.sendStartingMessageSequence=function(t){return this._lastMessageSequence=t,this.socket.onmessage=this._message,this._sendMessage({message_sequence:t}),this._needToNotifyOfDisconnect=!0,r.prototype._open.call(this)},e.prototype.stop=function(){return this._cleanUp()},e.prototype._message=function(t){var e,s,n;if(n=this.config.parse(t.data),this._restartKeepAlive(),!isPong(n))try{return this._lastMessageSequence=n.last_sequence,this.config.message(this.config.parse(n.message))}catch(s){e=s}},e.prototype._close=function(t){return(null!=t?t.wasClean:void 0)?this._cleanUp():this._error(t)},e.prototype._error=function(t){return this._cleanUp(),this._needToNotifyOfDisconnect&&(this._needToNotifyOfDisconnect=!1,this.config.disconnected()),this._succeeded?this.connect(this._retryDelay):this.config.failed?this.config.failed(this):void 0},e.prototype._cleanUp=function(){return this._clearKeepalive(),null!=this.socket?(this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()):void 0},e.prototype._restartKeepAlive=function(){var t,e;return t=function(t){return function(){return h(t.socket),e()}}(this),e=function(e){return function(){return e.keepaliveTimeout=setTimeout(t,o)}}(this),this._clearKeepalive(),e()},e.prototype._clearKeepalive=function(){return null!=this.keepaliveTimeout?(clearTimeout(this.keepaliveTimeout),this.keepaliveTimeout=null):void 0},e}(r),t.exports=c}).call(e,function(){return this}())},function(t,e,s){var n,i,o,r,c=function(t,e){return function(){return t.apply(e,arguments)}};n=s(1),r=s(4),o=s(2),i=function(){function t(t){var e,s,n,i,o,r,u,h;this.config=null!=t?t:{},this._connectPromise=c(this._connectPromise,this),this._upgradeTransport=c(this._upgradeTransport,this),this.stop=c(this.stop,this),this.connect=c(this.connect,this),this.longpollTransport=c(this.longpollTransport,this),this.websocketTransport=c(this.websocketTransport,this),this.connected=c(this.connected,this),(e=this.config).message||(e.message=function(){}),(s=this.config).error||(s.error=function(){}),(n=this.config).connected||(n.connected=function(){}),(i=this.config).disconnected||(i.disconnected=function(){}),(o=this.config).failed||(o.failed=function(){throw"Could not connect"}),(r=this.config).params||(r.params={}),(u=this.config).parse||(u.parse=JSON.parse),this._isConnected=!1,h=this.config.connected,this.config.connected=function(t){return function(){return t._isConnected=!0,h()}}(this)}return t.prototype.connected=function(){return this._isConnected},t.prototype.websocketTransport=function(t){return new r(t)},t.prototype.longpollTransport=function(t){return new o(t)},t.prototype.connect=function(t){var e;return null==t&&(t=0),e=this._connectPromise(),this.config.connectionVerified=this._upgradeTransport,r.supported()&&(this.upgradeTimeout=setTimeout(function(e){return function(){var s;return s=e.websocketTransport(e.config),s.connect(t)}}(this),500)),this.transport=this.longpollTransport(this.config),this.transport.connect(t),e},t.prototype.stop=function(){null!=this.upgradeTimeout&&(clearTimeout(this.upgradeTimeout),this.upgradeTimeout=null),this.transport.stop()},t.prototype._upgradeTransport=function(t){this.transport.stop(),t.sendStartingMessageSequence(this.transport.getLastMessageSequence()),this.transport=t},t.prototype._connectPromise=function(){var t,e;return t=n.Deferred(),e=this.config.connected,this.config.connected=function(s){return function(){return t.resolve(),e?(s.config.connected=e,e()):void 0}}(this),t.promise()},t}(),i.multiplexChannel="channels@firehose",t.exports=i},function(t,e,s){var n,i,o,r=function(t,e){return function(){return t.apply(e,arguments)}},c=function(t,e){function s(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},u={}.hasOwnProperty,h=[].slice;n=s(1),i=s(2),o=function(t){function e(t){this._success=r(this._success,this),this._subscriptions=r(this._subscriptions,this),this._updateLastMessageSequences=r(this._updateLastMessageSequences,this),this._request=r(this._request,this),this.unsubscribe=r(this.unsubscribe,this),this.subscribe=r(this.subscribe,this),e.__super__.constructor.call(this,t),this._lastMessageSequence={}}return c(e,t),e.prototype.subscribe=function(t,e){},e.prototype.unsubscribe=function(){var t;t=1<=arguments.length?h.call(arguments,0):[]},e.prototype._request=function(){var t;if(!this._stopRequestLoop)return t=this._subscriptions(),this._lastRequest=n.ajax({url:this.config.uri,firehose:!0,crossDomain:!0,method:"POST",data:t,dataType:"json",timeout:this._timeout,success:this._success,error:this._error,cache:!1})},e.prototype._updateLastMessageSequences=function(){var t,e,s,n,i;s=this.config.channels,n=[];for(t in s)e=s[t],(i=this._lastMessageSequence[t])?n.push(e.last_sequence=i):e.last_sequence?n.push(void 0):n.push(e.last_sequence=0);return n},e.prototype._subscriptions=function(){var t,e,s,n;this._updateLastMessageSequences(),n={},s=this.config.channels;for(t in s)e=s[t],n[t]=e.last_sequence||0;return JSON.stringify(n)},e.prototype._success=function(t,e,s){var n,i,o;if(!this._needToNotifyOfReconnect&&this._succeeded||(this._needToNotifyOfReconnect=!1,this._open(t)),!this._stopRequestLoop){if(200===s.status)try{o=JSON.parse(s.responseText),this._lastMessageSequence||(this._lastMessageSequence={}),this._lastMessageSequence[o.channel]=o.last_sequence,this.config.message(o)}catch(i){n=i}return this.connect(this._okInterval)}},e}(i),t.exports=o},function(t,e,s){var n,i,o,r=function(t,e){return function(){return t.apply(e,arguments)}},c=function(t,e){function s(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},u={}.hasOwnProperty,h=[].slice;i=s(4),o=function(t){return"PONG"===t.pong},n=function(t){function e(t){this._message=r(this._message,this),this._open=r(this._open,this),this.getLastMessageSequence=r(this.getLastMessageSequence,this),this.unsubscribe=r(this.unsubscribe,this),this.subscribe=r(this.subscribe,this),e.__super__.constructor.call(this,t)}return c(e,t),e.prototype.subscribe=function(t,e){return this._sendMessage({multiplex_subscribe:{channel:t,message_sequence:e.last_sequence}})},e.prototype.unsubscribe=function(){var t;return t=1<=arguments.length?h.call(arguments,0):[],this._sendMessage({multiplex_unsubscribe:t})},e.prototype.getLastMessageSequence=function(){return this._lastMessageSequence||{}},e.prototype._open=function(){var t,s,n,i;e.__super__._open.call(this),n=this.config.channels,i=[];for(t in n)s=n[t],this._lastMessageSequence&&(s.last_sequence=this._lastMessageSequence[t]),s.last_sequence||(s.last_sequence=0),i.push(this.subscribe(t,s));return i},e.prototype._message=function(t){var e,s,n;if(n=this.config.parse(t.data),this._restartKeepAlive(),!o(n))try{return this._lastMessageSequence||(this._lastMessageSequence={}),this._lastMessageSequence[n.channel]=n.last_sequence,this.config.message(n)}catch(s){e=s}},e}(i),t.exports=n},function(t,e,s){t.exports={version:"1.0.1",codeName:"Jingle All the Way",Consumer:s(5),LongPollTransport:s(2),MultiplexedConsumer:s(9),MultiplexedLongPoll:s(6),Transport:s(3),WebSocketTransport:s(4),MultiplexedWebSocket:s(7)}},function(t,e,s){var n,i,o,r,c=function(t,e){return function(){return t.apply(e,arguments)}},u=function(t,e){function s(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},h={}.hasOwnProperty,a=[].slice;n=s(5),r=s(7),o=s(6),i=function(t){function e(t){var s,i,o,r,u;this.config=null!=t?t:{},this.unsubscribe=c(this.unsubscribe,this),this.subscribe=c(this.subscribe,this),this._updateSubscriptions=c(this._updateSubscriptions,this),this._removeSubscriptionHandler=c(this._removeSubscriptionHandler,this),this._addSubscriptionHandler=c(this._addSubscriptionHandler,this),this.message=c(this.message,this),this.longpollTransport=c(this.longpollTransport,this),this.websocketTransport=c(this.websocketTransport,this),this.messageHandlers={},(s=this.config).message||(s.message=this.message),(i=this.config).channels||(i.channels={}),this.config.uri+=n.multiplexChannel,this._updateSubscriptions(),u=this.config.channels;for(o in u)r=u[o],this._addSubscriptionHandler(o,r);e.__super__.constructor.call(this,this.config)}return u(e,t),e.subscriptionQuery=function(t){var e,s;return{subscribe:[function(){var n,i;n=t.channels,i=[];for(e in n)s=n[e],i.push(e+"!"+(s.last_sequence||0));return i}()].join(",")}},e.normalizeChannels=function(t){var e,s,n,i;n=t.channels,i=[];for(e in n)s=n[e],"/"!==e[0]?(delete t.channels[e],i.push(t.channels["/"+e]=s)):i.push(void 0);return i},e.normalizeChannel=function(t){return"/"!==t[0]?"/"+t:t},e.prototype.websocketTransport=function(t){return new r(t)},e.prototype.longpollTransport=function(t){return new o(t)},e.prototype.message=function(t){var e;return(e=this.messageHandlers[t.channel])?e(this.config.parse(t.message)):void 0},e.prototype._addSubscriptionHandler=function(t,e){return e.message?this.messageHandlers[t]=e.message:void 0},e.prototype._removeSubscriptionHandler=function(){var t,e,s,n,i;for(e=1<=arguments.length?a.call(arguments,0):[],i=[],s=0,n=e.length;n>s;s++)t=e[s],i.push(delete this.messageHandlers[t]);return i},e.prototype._updateSubscriptions=function(){return e.normalizeChannels(this.config)},e.prototype.subscribe=function(t,s){return null==s&&(s={}),t=e.normalizeChannel(t),this.config.channels[t]=s,this._updateSubscriptions(),this._addSubscriptionHandler(t,s),this.transport.subscribe(t,s)},e.prototype.unsubscribe=function(){var t,s,n,i,o;if(s=1<=arguments.length?a.call(arguments,0):[],this.connected()){for(n=0,i=s.length;i>n;n++)t=s[n],t=e.normalizeChannel(t),delete this.config.channels[t];return this._updateSubscriptions(),this._removeSubscriptionHandler.apply(this,s),(o=this.transport).unsubscribe.apply(o,s)}},e}(n),t.exports=i}]);
//# sourceMappingURL=firehose.js.map