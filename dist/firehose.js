webpackJsonp([1],[function(t,e,s){window.$=window.jQuery=s(7),$(window),window.Firehose=s(9)},function(t,e,s){var n,i,o=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function s(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=s(2),n=function(t){function e(t){this._error=o(this._error,this),this._ping=o(this._ping,this),this._success=o(this._success,this),this.stop=o(this.stop,this),this._requestParams=o(this._requestParams,this),this._request=o(this._request,this),this._protocol=o(this._protocol,this);var s,n,i,r;e.__super__.constructor.call(this,t),null==(s=this.config).ssl&&(s.ssl=!1),(n=this.config).longPoll||(n.longPoll={}),(i=this.config.longPoll).url||(i.url=this._protocol()+":"+this.config.uri),(r=this.config.longPoll).timeout||(r.timeout=25e3),this._lagTime=5e3,this._timeout=this.config.longPoll.timeout+this._lagTime,this._okInterval=this.config.okInterval||0,this._stopRequestLoop=!1,this._lastMessageSequence=0}return r(e,t),e.prototype.messageSequenceHeader="Pragma",e.prototype.name=function(){return"LongPoll"},e.ieSupported=function(){return(document.documentMode||10)>=8},e.supported=function(){var t;if(t=$.ajaxSettings.xhr())return"withCredentials"in t||e.ieSupported()},e.prototype._protocol=function(){return this.config.ssl?"https":"http"},e.prototype._request=function(){var t;if(!this._stopRequestLoop)return t=this._requestParams(),t.last_message_sequence=this._lastMessageSequence,this._lastRequest=$.ajax({url:this.config.longPoll.url,firehose:!0,crossDomain:!0,data:t,timeout:this._timeout,success:this._success,error:this._error,cache:!1,statusCode:{500:this._error}})},e.prototype._requestParams=function(){return"function"==typeof this.config.params?this.config.params():this.config.params},e.prototype.stop=function(){var t,e,s;if(this._stopRequestLoop=!0,null!=this._lastRequest){try{this._lastRequest.abort()}catch(e){t=e}delete this._lastRequest}if(null!=this._lastPingRequest){try{this._lastPingRequest.abort()}catch(s){t=s}return delete this._lastPingRequest}},e.prototype._success=function(t,e,s){var n,i,o,r,c;if(!this._needToNotifyOfReconnect&&this._succeeded||(this._needToNotifyOfReconnect=!1,this._open(t)),!this._stopRequestLoop){if(200===s.status)try{c=JSON.parse(s.responseText),r=c.message,o=c.last_sequence,this._lastMessageSequence=o||0,this.config.message(this.config.parse(r))}catch(i){n=i}return this.connect(this._okInterval)}},e.prototype._ping=function(){return this._lastPingRequest=$.ajax({url:this.config.uri,method:"HEAD",crossDomain:!0,firehose:!0,data:this._requestParams(),success:function(t){return function(){if(t._needToNotifyOfReconnect)return t._needToNotifyOfReconnect=!1,t.config.connected(t)}}(this)})},e.prototype._error=function(t,e,s){if(500===t.status&&(s=JSON.parse(t.responseText),"Subscription failed"===s.error&&this.config.subscriptionFailed(s)),this._needToNotifyOfReconnect||this._stopRequestLoop||(this._needToNotifyOfReconnect=!0,this.config.disconnected()),!this._stopRequestLoop)return setTimeout(this._ping,this._retryDelay+this._lagTime),setTimeout(this._request,this._retryDelay)},e}(i),t.exports=n},function(t,e){var s,n=function(t,e){return function(){return t.apply(e,arguments)}};s=function(){function t(t){var e;null==t&&(t={}),this.getLastMessageSequence=n(this.getLastMessageSequence,this),this._close=n(this._close,this),this._open=n(this._open,this),this._error=n(this._error,this),this.connect=n(this.connect,this),this.config=t,(e=this.config).params||(e.params={}),this._retryDelay=3e3}return t.supported=function(){return!1},t.prototype.connect=function(t){return null==t&&(t=0),setTimeout(this._request,t),this},t.prototype.name=function(){throw"not implemented in base Transport"},t.prototype.stop=function(){throw"not implemented in base Transport"},t.prototype._request=function(){throw"not implemented in base Transport"},t.prototype._error=function(t){return this._succeeded?(this.config.disconnected(),this.connect(this._retryDelay)):this.config.failed(this)},t.prototype._open=function(t){return this._succeeded=!0,this.config.connected(this)},t.prototype._close=function(t){return this.config.disconnected()},t.prototype.getLastMessageSequence=function(){return this._lastMessageSequence||0},t}(),t.exports=s},function(t,e,s){(function(e){var n,i,o,r,c,u,a=function(t,e){return function(){return t.apply(e,arguments)}},h=function(t,e){function s(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=s(2),n=2e3,i=2e4,u=function(t){return t.send(JSON.stringify({ping:"PING"}))},c=function(){return("undefined"!=typeof window&&null!==window?window.WebSocket:void 0)||("undefined"!=typeof e&&null!==e?e.WebSocket:void 0)},r=function(t){function e(t){this._clearKeepalive=a(this._clearKeepalive,this),this._restartKeepAlive=a(this._restartKeepAlive,this),this._cleanUp=a(this._cleanUp,this),this._error=a(this._error,this),this._close=a(this._close,this),this._message=a(this._message,this),this.stop=a(this.stop,this),this.sendStartingMessageSequence=a(this.sendStartingMessageSequence,this),this._lookForInitialPong=a(this._lookForInitialPong,this),this._open=a(this._open,this),this._requestParams=a(this._requestParams,this),this._protocol=a(this._protocol,this),this._request=a(this._request,this),this._sendMessage=a(this._sendMessage,this);var s;e.__super__.constructor.call(this,t),(s=this.config).webSocket||(s.webSocket={}),this.config.webSocket.connectionVerified=this.config.connectionVerified}return h(e,t),e.prototype.name=function(){return"WebSocket"},e.ieSupported=function(){return(document.documentMode||10)>9},e.supported=function(){return!!c()},e.prototype._sendMessage=function(t){var e;return null!=(e=this.socket)?e.send(JSON.stringify(t)):void 0},e.prototype._request=function(){var t,e,s;try{return s=c(),this.socket=new s(this._protocol()+":"+this.config.uri+"?"+$.param(this._requestParams())),this.socket.onopen=this._open,this.socket.onclose=this._close,this.socket.onerror=this._error,this.socket.onmessage=this._lookForInitialPong}catch(e){return t=e,"undefined"!=typeof console&&null!==console?console.log(t):void 0}},e.prototype._protocol=function(){return this.config.ssl?"wss":"ws"},e.prototype._requestParams=function(){return"function"==typeof this.config.params?this.config.params():this.config.params},e.prototype._open=function(){return u(this.socket)},e.prototype._lookForInitialPong=function(t){var e;if(this._restartKeepAlive(),this._isPong(function(){var s;try{return JSON.parse(t.data)}catch(s){return e=s,{}}}()))return null!=this._lastMessageSequence?this.sendStartingMessageSequence(this._lastMessageSequence):this.config.webSocket.connectionVerified(this)},e.prototype.sendStartingMessageSequence=function(t){return this._lastMessageSequence=t,this.socket.onmessage=this._message,this._sendMessage({message_sequence:t}),this._needToNotifyOfDisconnect=!0,o.prototype._open.call(this)},e.prototype.stop=function(){return this._cleanUp()},e.prototype._message=function(t){var e,s,n;if(n=this.config.parse(t.data),this._restartKeepAlive(),this._isSubscriptionFailed(n))return this.config.subscriptionFailed(n);if(!this._isPong(n))try{return this._lastMessageSequence=n.last_sequence,this.config.message(this.config.parse(n.message))}catch(s){e=s}},e.prototype._close=function(t){return(null!=t?t.wasClean:void 0)?this._cleanUp():this._error(t)},e.prototype._error=function(t){return this._cleanUp(),this._needToNotifyOfDisconnect&&(this._needToNotifyOfDisconnect=!1,this.config.disconnected()),this._succeeded?this.connect(this._retryDelay):this.config.failed?this.config.failed(this):void 0},e.prototype._cleanUp=function(){if(this._clearKeepalive(),null!=this.socket)return this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()},e.prototype._restartKeepAlive=function(){var t,e;return t=function(t){return function(){return u(t.socket),e()}}(this),e=function(e){return function(){return e.keepaliveTimeout=setTimeout(t,i)}}(this),this._clearKeepalive(),e()},e.prototype._clearKeepalive=function(){if(null!=this.keepaliveTimeout)return clearTimeout(this.keepaliveTimeout),this.keepaliveTimeout=null},e.prototype._isPong=function(t){return"PONG"===t.pong},e.prototype._isSubscriptionFailed=function(t){return"Subscription Failed"===t.error},e}(o),t.exports=r}).call(e,function(){return this}())},function(t,e,s){var n,i,o,r=function(t,e){return function(){return t.apply(e,arguments)}};o=s(3),i=s(1),n=function(){function t(t){var e,s,n,i,o,c,u,a,h;this.config=null!=t?t:{},this._connectPromise=r(this._connectPromise,this),this._upgradeTransport=r(this._upgradeTransport,this),this.stop=r(this.stop,this),this.connect=r(this.connect,this),this.longpollTransport=r(this.longpollTransport,this),this.websocketTransport=r(this.websocketTransport,this),this.connected=r(this.connected,this),(e=this.config).message||(e.message=function(){}),(s=this.config).error||(s.error=function(){}),(n=this.config).connected||(n.connected=function(){}),(i=this.config).disconnected||(i.disconnected=function(){}),(o=this.config).failed||(o.failed=function(){throw"Could not connect"}),(c=this.config).subscriptionFailed||(c.subscriptionFailed=function(){}),(u=this.config).params||(u.params={}),(a=this.config).parse||(a.parse=JSON.parse),this._isConnected=!1,h=this.config.connected,this.config.connected=function(t){return function(){return t._isConnected=!0,h()}}(this)}return t.prototype.connected=function(){return this._isConnected},t.prototype.websocketTransport=function(t){return new o(t)},t.prototype.longpollTransport=function(t){return new i(t)},t.prototype.connect=function(t){var e;return null==t&&(t=0),e=this._connectPromise(),this.config.connectionVerified=this._upgradeTransport,o.supported()&&(this.upgradeTimeout=setTimeout(function(e){return function(){var s;return s=e.websocketTransport(e.config),s.connect(t)}}(this),500)),this.transport=this.longpollTransport(this.config),this.transport.connect(t),e},t.prototype.stop=function(){null!=this.upgradeTimeout&&(clearTimeout(this.upgradeTimeout),this.upgradeTimeout=null),this.transport.stop()},t.prototype._upgradeTransport=function(t){this.transport.stop(),t.sendStartingMessageSequence(this.transport.getLastMessageSequence()),this.transport=t},t.prototype._connectPromise=function(){var t,e;return t=$.Deferred(),e=this.config.connected,this.config.connected=function(s){return function(){if(t.resolve(),e)return s.config.connected=e,e()}}(this),t.promise()},t}(),n.multiplexChannel="channels@firehose",t.exports=n},function(t,e,s){var n,i,o=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function s(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},c={}.hasOwnProperty,u=[].slice;n=s(1),i=function(t){function e(t){this._success=o(this._success,this),this._subscriptions=o(this._subscriptions,this),this._updateLastMessageSequences=o(this._updateLastMessageSequences,this),this._request=o(this._request,this),this.unsubscribe=o(this.unsubscribe,this),this.subscribe=o(this.subscribe,this),e.__super__.constructor.call(this,t),this._lastMessageSequence={}}return r(e,t),e.prototype.subscribe=function(t,e){},e.prototype.unsubscribe=function(){var t;t=1<=arguments.length?u.call(arguments,0):[]},e.prototype._request=function(){var t;if(!this._stopRequestLoop)return t=this._subscriptions(),this._lastRequest=$.ajax({url:this.config.uri,firehose:!0,crossDomain:!0,method:"POST",data:t,dataType:"json",timeout:this._timeout,success:this._success,error:this._error,cache:!1})},e.prototype._updateLastMessageSequences=function(){var t,e,s,n,i;s=this.config.channels,n=[];for(t in s)e=s[t],(i=this._lastMessageSequence[t])?n.push(e.last_sequence=i):e.last_sequence?n.push(void 0):n.push(e.last_sequence=0);return n},e.prototype._subscriptions=function(){var t,e,s,n;this._updateLastMessageSequences(),n={},s=this.config.channels;for(t in s)e=s[t],n[t]=e.last_sequence||0;return JSON.stringify(n)},e.prototype._success=function(t,e,s){var n,i,o;if(!this._needToNotifyOfReconnect&&this._succeeded||(this._needToNotifyOfReconnect=!1,this._open(t)),!this._stopRequestLoop){if(200===s.status)try{o=JSON.parse(s.responseText),this._lastMessageSequence||(this._lastMessageSequence={}),this._lastMessageSequence[o.channel]=o.last_sequence,this.config.message(o)}catch(i){n=i}return this.connect(this._okInterval)}},e}(n),t.exports=i},function(t,e,s){var n,i,o=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function s(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},c={}.hasOwnProperty,u=[].slice;i=s(3),n=function(t){function e(t){this._message=o(this._message,this),this._open=o(this._open,this),this.getLastMessageSequence=o(this.getLastMessageSequence,this),this.unsubscribe=o(this.unsubscribe,this),this.subscribe=o(this.subscribe,this),e.__super__.constructor.call(this,t)}return r(e,t),e.prototype.subscribe=function(t,e){return this._sendMessage({multiplex_subscribe:{channel:t,message_sequence:e.last_sequence}})},e.prototype.unsubscribe=function(){var t;return t=1<=arguments.length?u.call(arguments,0):[],this._sendMessage({multiplex_unsubscribe:t})},e.prototype.getLastMessageSequence=function(){return this._lastMessageSequence||{}},e.prototype._open=function(){var t,s,n,i;e.__super__._open.call(this),n=this.config.channels,i=[];for(t in n)s=n[t],this._lastMessageSequence&&(s.last_sequence=this._lastMessageSequence[t]),s.last_sequence||(s.last_sequence=0),i.push(this.subscribe(t,s));return i},e.prototype._message=function(t){var e,s,n;if(n=this.config.parse(t.data),this._restartKeepAlive(),!this._isPong(n))try{return this._lastMessageSequence||(this._lastMessageSequence={}),this._lastMessageSequence[n.channel]=n.last_sequence,this.config.message(n)}catch(s){e=s}},e}(i),t.exports=n},,function(t,e){t.exports={name:"firehose-client",version:"1.0.3",codeName:"Jingle All the Way",main:"lib/index.js",scripts:{build:"webpack -p","build:watch":"webpack --watch",test:"JASMINE_CONFIG_PATH=./spec/javascripts/support/jasmine.json jasmine"},devDependencies:{"clean-webpack-plugin":"^0.1.9",codo:"git://github.com/coffeedoc/codo.git","coffee-loader":"^0.7.2",coffeelint:"^1.14.0","coffeelint-function-call-whitespace":"^0.1.3","coffeelint-prefer-double-quotes":"^0.1.0","coffeelint-prefer-symbol-operator":"^0.1.1",jasmine:"^2.4.1","json-loader":"^0.5.4",sinon:"^1.17.4",webpack:"^1.13.1"},dependencies:{"coffee-script":"^1.10.0",jquery:"^2.2.4",jsdom:"^9.2.1",ws:"^1.1.0",xmlhttprequest:"^1.8.0"},repository:{type:"git",url:"git://github.com/firehoseio/js_client.git"}}},function(t,e,s){var n=null;e=t.exports=s(10),e.version=n},function(t,e,s){t.exports={version:s(8).version,codeName:s(8).codeName,Consumer:s(4),LongPollTransport:s(1),MultiplexedConsumer:s(11),MultiplexedLongPoll:s(5),Transport:s(2),WebSocketTransport:s(3),MultiplexedWebSocket:s(6)}},function(t,e,s){var n,i,o,r,c=function(t,e){return function(){return t.apply(e,arguments)}},u=function(t,e){function s(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},a={}.hasOwnProperty,h=[].slice;n=s(4),r=s(6),o=s(5),i=function(t){function e(t){var s,i,o,r,u;this.config=null!=t?t:{},this.unsubscribe=c(this.unsubscribe,this),this.subscribe=c(this.subscribe,this),this._updateSubscriptions=c(this._updateSubscriptions,this),this._removeSubscriptionHandler=c(this._removeSubscriptionHandler,this),this._addSubscriptionHandler=c(this._addSubscriptionHandler,this),this.message=c(this.message,this),this.longpollTransport=c(this.longpollTransport,this),this.websocketTransport=c(this.websocketTransport,this),this.messageHandlers={},(s=this.config).message||(s.message=this.message),(i=this.config).channels||(i.channels={}),this.config.uri+=n.multiplexChannel,this._updateSubscriptions(),u=this.config.channels;for(o in u)r=u[o],this._addSubscriptionHandler(o,r);e.__super__.constructor.call(this,this.config)}return u(e,t),e.subscriptionQuery=function(t){var e,s;return{subscribe:[function(){var n,i;n=t.channels,i=[];for(e in n)s=n[e],i.push(e+"!"+(s.last_sequence||0));return i}()].join(",")}},e.normalizeChannels=function(t){var e,s,n,i;n=t.channels,i=[];for(e in n)s=n[e],"/"!==e[0]?(delete t.channels[e],i.push(t.channels["/"+e]=s)):i.push(void 0);return i},e.normalizeChannel=function(t){return"/"!==t[0]?"/"+t:t},e.prototype.websocketTransport=function(t){return new r(t)},e.prototype.longpollTransport=function(t){return new o(t)},e.prototype.message=function(t){var e;if(e=this.messageHandlers[t.channel])return e(this.config.parse(t.message))},e.prototype._addSubscriptionHandler=function(t,e){if(e.message)return this.messageHandlers[t]=e.message},e.prototype._removeSubscriptionHandler=function(){var t,e,s,n,i;for(e=1<=arguments.length?h.call(arguments,0):[],i=[],s=0,n=e.length;s<n;s++)t=e[s],i.push(delete this.messageHandlers[t]);return i},e.prototype._updateSubscriptions=function(){return e.normalizeChannels(this.config)},e.prototype.subscribe=function(t,s){return null==s&&(s={}),t=e.normalizeChannel(t),this.config.channels[t]=s,this._updateSubscriptions(),this._addSubscriptionHandler(t,s),this.transport.subscribe(t,s)},e.prototype.unsubscribe=function(){var t,s,n,i,o;if(s=1<=arguments.length?h.call(arguments,0):[],this.connected()){for(n=0,i=s.length;n<i;n++)t=s[n],t=e.normalizeChannel(t),delete this.config.channels[t];return this._updateSubscriptions(),this._removeSubscriptionHandler.apply(this,s),(o=this.transport).unsubscribe.apply(o,s)}},e}(n),t.exports=i}]);
//# sourceMappingURL=firehose.js.map